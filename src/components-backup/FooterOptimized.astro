---
import { siteConfig } from '@/config/site';
import { getCachedFooterData } from '@/lib/footer-data';

// Get all footer data in one cached call
const footerData = await getCachedFooterData();
const { 
  currentYear, 
  footerLocations, 
  mapConfig, 
  mapEmbedUrl, 
  isIframe, 
  hasMap,
  quickLinks,
  services
} = footerData;
---

<footer class="bg-gray-900 text-gray-300">
  <div class="container mx-auto px-4 py-12">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      
      <!-- Business Info -->
      <div>
        <h3 class="text-white font-bold text-lg mb-4">{siteConfig.businessName}</h3>
        <div class="space-y-2 text-sm">
          <p>{siteConfig.address.street}</p>
          <p>{siteConfig.address.city}, {siteConfig.address.state} {siteConfig.address.postcode}</p>
          <p class="mt-4">
            <a href={`tel:${siteConfig.phone}`} class="hover:text-white transition-colors">
              üìû {siteConfig.formattedPhone}
            </a>
          </p>
          <p>
            <a href={`mailto:${siteConfig.email}`} class="hover:text-white transition-colors">
              ‚úâÔ∏è {siteConfig.email}
            </a>
          </p>
        </div>
      </div>

      <!-- Quick Links -->
      <div>
        <h3 class="text-white font-bold text-lg mb-4">Quick Links</h3>
        <ul class="space-y-2 text-sm">
          {quickLinks.map(link => (
            <li>
              <a href={link.href} class="hover:text-white transition-colors">
                {link.label}
              </a>
            </li>
          ))}
        </ul>
      </div>

      <!-- Services -->
      <div>
        <h3 class="text-white font-bold text-lg mb-4">Our Services</h3>
        <ul class="space-y-2 text-sm">
          {services.map(service => (
            <li>
              <a href={`/services/${service.slug}/`} class="hover:text-white transition-colors">
                {service.title}
              </a>
            </li>
          ))}
        </ul>
      </div>

      <!-- Map Embed -->
      <div class="md:col-span-1">
        {hasMap && (
          <div class="map-embed">
            {isIframe ? (
              <div set:html={mapConfig.content} />
            ) : (
              <iframe
                src={mapEmbedUrl}
                width="100%"
                height="400"
                style="border:0;"
                allowfullscreen
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"
                title={`Map showing location of ${siteConfig.businessName}`}
              />
            )}
          </div>
        )}
      </div>
    </div>

    <!-- Service Areas -->
    {footerLocations.length > 0 && (
      <div class="border-t border-gray-800 mt-8 pt-8">
        <h3 class="text-white font-bold text-lg mb-4">Service Areas</h3>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-sm">
          {footerLocations.map(location => (
            <a 
              href={location.url} 
              class="hover:text-white transition-colors"
              title={`${siteConfig.businessName} services in ${location.name}, ${location.state}`}
            >
              {location.name}
            </a>
          ))}
        </div>
      </div>
    )}

    <!-- Copyright -->
    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-sm">
      <p>¬© {currentYear} {siteConfig.businessName}. All rights reserved.</p>
      <div class="mt-2 space-x-4">
        <a href="/privacy" class="hover:text-white transition-colors">Privacy Policy</a>
        <span>‚Ä¢</span>
        <a href="/terms" class="hover:text-white transition-colors">Terms of Service</a>
      </div>
    </div>
  </div>
</footer>

<style>
  .map-embed {
    border-radius: 0.5rem;
    overflow: hidden;
  }
  
  .map-embed :global(iframe) {
    width: 100%;
    height: 300px;
  }
  
  @media (min-width: 768px) {
    .map-embed :global(iframe) {
      height: 400px;
    }
  }
</style>